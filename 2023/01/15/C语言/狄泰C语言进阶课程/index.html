

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GODXQI">
  <meta name="keywords" content="">
  
    <meta name="description" content="** C语言进阶课程**  goto潜规则：禁用 C语言是面向过程的结构化语言，C语言主要结构只有三种：顺序执行，选择执行，循环执行，而goto破坏了C语言的结构化特性，使程序使用第四种方式运行，使程序结构化下降  void修饰函数返回值和参数： -如果没有返回值，那么应该将其声明为void； -如果函数没有参数，应该声明其参数为void； void修饰函数返回值和参数是为了表示“无”，若不写则视">
<meta property="og:type" content="article">
<meta property="og:title" content="狄泰C语言进阶课程">
<meta property="og:url" content="https://godxqi.github.io/2023/01/15/C%E8%AF%AD%E8%A8%80/%E7%8B%84%E6%B3%B0C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6%E8%AF%BE%E7%A8%8B/index.html">
<meta property="og:site_name" content="GODXQI&#39;s Blog">
<meta property="og:description" content="** C语言进阶课程**  goto潜规则：禁用 C语言是面向过程的结构化语言，C语言主要结构只有三种：顺序执行，选择执行，循环执行，而goto破坏了C语言的结构化特性，使程序使用第四种方式运行，使程序结构化下降  void修饰函数返回值和参数： -如果没有返回值，那么应该将其声明为void； -如果函数没有参数，应该声明其参数为void； void修饰函数返回值和参数是为了表示“无”，若不写则视">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222040963.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222040957.png">
<meta property="og:image" content="https://godxqi.github.io/image/6a9fa30f9679f008874084884bb13964.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222219637.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222303284.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222303331.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222303314.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222349679.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222349697.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222349691.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222349716.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222349725.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222432572.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222432593.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222432594.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222510862.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222510886.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222554814.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222554831.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222554851.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222554873.png">
<meta property="og:image" content="https://godxqi.github.io/image/20190703222554853.png">
<meta property="og:image" content="https://godxqi.github.io/image/Slide10.PNG">
<meta property="og:image" content="https://godxqi.github.io/image/0d02d40684aeee981de901baa4201f04.png">
<meta property="og:image" content="https://godxqi.github.io/image/81457ebe9ab393c3beb307a562a51431.png">
<meta property="og:image" content="https://godxqi.github.io/image/d2a94a10dd2172a2d0bb16f122e262df.png">
<meta property="og:image" content="https://godxqi.github.io/image/2fd02023538e4a5de653dbdcaafb452a.png">
<meta property="og:image" content="https://godxqi.github.io/image/ef9f2cd13968402ae42b7c1d7f9c6516.png">
<meta property="article:published_time" content="2023-01-15T12:19:10.769Z">
<meta property="article:modified_time" content="2023-01-15T12:22:52.629Z">
<meta property="article:author" content="GODXQI">
<meta property="article:tag" content="C">
<meta property="article:tag" content="未重构">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://godxqi.github.io/image/20190703222040963.png">
  
  
  
  <title>狄泰C语言进阶课程 - GODXQI&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"godxqi.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>GODXQI</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="狄泰C语言进阶课程"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-01-15 20:19" pubdate>
          January 15, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          37k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          312 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">狄泰C语言进阶课程</h1>
            
            
              <div class="markdown-body">
                
                <p>** C语言进阶课程**</p>
<hr>
<p>goto潜规则：禁用</p>
<p>C语言是面向过程的结构化语言，C语言主要结构只有三种：顺序执行，选择执行，循环执行，而goto破坏了C语言的结构化特性，使程序使用第四种方式运行，使程序结构化下降</p>
<hr>
<p>void修饰函数返回值和参数：</p>
<p>-如果没有返回值，那么应该将其声明为void；</p>
<p>-如果函数没有参数，应该声明其参数为void；</p>
<p>void修饰函数返回值和参数是为了表示“无”，若不写则视为默认（函数默认有返回值，有参数）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-built_in">f</span>()<br>&#123;<br><br>&#125;     <span class="hljs-comment">//这个函数有返回值，因为不写参数，默认可以接受任意的参数。</span><br><br><span class="hljs-comment">//不写返回值，默认为int</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>       <span class="hljs-type">int</span> i = <span class="hljs-built_in">f</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>       <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>void的意义</p>
<p>不存在void变量。</p>
<p>C语言没有定义void究竟是多大内存的别名。</p>
<p>(1）没有void的标尺；无法在内存中裁剪出void对应的变量；</p>
<p>(2）不能定义void类型变量，数组；</p>
<p>(3）可以定义void*类型指针，因为任意指针不是4个就是8个，void可以卡出这个大小。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-keyword">var</span>;        <span class="hljs-comment">//error</span><br>    <span class="hljs-keyword">void</span> array[<span class="hljs-number">5</span>];   <span class="hljs-comment">//error</span><br>    <span class="hljs-keyword">void</span>* pv;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小贴士：</p>
<p>-ANSI C：标准C语言的规范</p>
<p>-扩展C：在ANSI C的基础上进行了扩充</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    printf(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">void</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上面的代码在ASNI C编译器中无法通过编译，但是对于支持GNU标准的gcc编译器而言是合法的</p>
<p>void指针的意义：</p>
<p>（1）C语言只有相同类型的指针才可以相互赋值；</p>
<p>（2）void*指针作为左值用于“接收”任意类型的指针；</p>
<p>（3）void*指针作为右值使用时需要进行强制类型转换；</p>
<p>（4）不同类型的地址值不能相互赋值</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs abnf">int* pI <span class="hljs-operator">=</span> (int*)malloc(sizeof(int))<span class="hljs-comment">;</span><br>char* pC <span class="hljs-operator">=</span> (char*)malloc(sizeof(char))<span class="hljs-comment">;</span><br>void* p <span class="hljs-operator">=</span> NULL<span class="hljs-comment">;</span><br>int* pni <span class="hljs-operator">=</span> NULL<span class="hljs-comment">;</span><br>char* pnc <span class="hljs-operator">=</span> NULL<span class="hljs-comment">;</span><br><br><span class="hljs-attribute">p</span> <span class="hljs-operator">=</span> pI<span class="hljs-comment">;    //ok</span><br><span class="hljs-attribute">pni</span> <span class="hljs-operator">=</span> p<span class="hljs-comment">;    //oops!</span><br><br><span class="hljs-attribute">p</span> <span class="hljs-operator">=</span> pC<span class="hljs-comment">;    //ok</span><br><span class="hljs-attribute">pnc</span> <span class="hljs-operator">=</span> p<span class="hljs-comment">;    //oops!</span><br></code></pre></td></tr></table></figure>

<p>例：程序实现MenSet函数：（将一段内存（数组）的每个字节设置为一个数，eg：0）</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">void <span class="hljs-constructor">MemSet(<span class="hljs-params">void</span><span class="hljs-operator">*</span> <span class="hljs-params">src</span>, <span class="hljs-params">int</span> <span class="hljs-params">length</span>, <span class="hljs-params">unsigned</span> <span class="hljs-params">char</span> <span class="hljs-params">n</span>)</span><br>&#123;<br>    unsigned <span class="hljs-built_in">char</span>* p = (unsigned <span class="hljs-built_in">char</span>*)src;<br>    <br>    <span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;length; i++)<br>    &#123;<br>        p<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span> = n;<br>    &#125;<br>&#125;<br><br><span class="hljs-built_in">int</span> main<span class="hljs-literal">()</span><br>&#123;<br>    <span class="hljs-built_in">int</span> a<span class="hljs-literal">[<span class="hljs-number">5</span>]</span>;<br>    <span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-constructor">MemSet(<span class="hljs-params">a</span>, <span class="hljs-params">sizeof</span>(<span class="hljs-params">a</span>)</span>, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        printf(<span class="hljs-string">&quot;%d\n&quot;</span>, a<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span>);<br>    &#125;<br>    <br>    return <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p>sizeof关键字：</p>
<p>sizeof关键字的用法</p>
<p>（1）sizeof是编译器的内置指示符；</p>
<p>（2）sizeof用于计算类型或变量所占的内存大小；</p>
<p>（3）sizeof的值在编译期就已经确定；</p>
<p>sizeof用于类型：sizeof(type)</p>
<p>sizeof用于变量：sizeof(var)    sizeof var</p>
<p>（从sizeof var 这一点就能知道它不是函数，因为函数调用没有这样的语法。）</p>
<p>sizeof是C语言的内置关键字而不是函数：</p>
<p>（1）在编译过程中所有的sizeof将被具体的数值所替换。</p>
<p>（2）程序的执行过程与sizeof没有任何关系。</p>
<p>例：下面的程序输出什么？</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-built_in">int</span> <span class="hljs-keyword">var</span> = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">int</span> <span class="hljs-built_in">size</span> = sizeof(<span class="hljs-keyword">var</span>++);        <span class="hljs-comment">//编译期间sizeof已经被4所替换，var++根本得不到执行</span><br>printf(<span class="hljs-string">&quot;var = %d, size = %d\n&quot;</span>, <span class="hljs-keyword">var</span>, <span class="hljs-built_in">size</span>);<br>运行结果：<span class="hljs-keyword">var</span> = <span class="hljs-number">0</span>, <span class="hljs-built_in">size</span> = <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Delphi Tang\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> var = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-type">int</span> size = <span class="hljs-built_in">sizeof</span>(var++);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;var = %d, size = %d\n&quot;</span>, var, size);<br><br>    size = <span class="hljs-built_in">sizeof</span>(<span class="hljs-built_in">f</span>());<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;size = %d\n&quot;</span>, size);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>运行结果：<br>var = <span class="hljs-number">0</span>, size = <span class="hljs-number">4</span><br>size = <span class="hljs-number">4</span><br>可以发现函数<span class="hljs-built_in">f</span>()并没执行<br></code></pre></td></tr></table></figure>

<p>结论：sizeof不是函数，不会到程序运行期再来计算结果，sizeof是编译器的一个指示符，告诉编译器在编译时就计算结果，因此在编译结束后所有sizeof都会被具体数值所替代</p>
<hr>
<p>typedef的意义</p>
<p>typedef用于给一个已经存在的数据类型重命名；</p>
<p>typedef本质上不能产生新的类型；</p>
<p>typedef重命名的类型：</p>
<p>1）可以在typedef语句之后定义；</p>
<p>2）不能被unsigned和signed修饰；</p>
<p>用法：</p>
<p>       typedef type new_name;</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">int</span> Int32;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">_tag_point</span><br>&#123;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> y;<br>&#125;;<br><br><span class="hljs-keyword">typedef</span> structt _tag_point Point;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span><br>&#123;<br>    <span class="hljs-type">int</span> length;<br>    <span class="hljs-type">int</span> array[];<br>&#125;SoftArray;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">_tag_list_node</span> ListNode;    <br>    <span class="hljs-comment">/* 告诉程序只要看到ListNode把它替换成struct _tag_list_node就可以，而struct _tag_list_node在哪定义对于编译器在做这一行编译工作的时候是无所谓的 */</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">_tag_list_node</span><br>&#123;<br>    ListNode* next;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    Int32 i = <span class="hljs-number">-100</span>;<br>    <span class="hljs-comment">//unsigned Int32 ii = 0;    //重命名的类型是不能被unsigned,signed修饰</span><br>    Point p;<br>    SoftArray* sa = <span class="hljs-literal">NULL</span>;<br>    ListNode* node = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编译器并没有说明被重命名的类型必须要先定义才可以，这是我们的主观想法，即重名的类型可以在typedef语句后定义，甚至用typedef重命名后，并不定义也不去用重命名的类型也没事</p>
<hr>
<p>注释符号：</p>
<p>注释规则：</p>
<p>（1）编译器在编译过程中使用空格替换整个注释；</p>
<p>（2）字符串字面量中的&#x2F;&#x2F;和&#x2F;*…*&#x2F;不代表注释符号了；</p>
<p>（3）&#x2F;*……*&#x2F;型注释不能被嵌套；</p>
<p>C语言中‘\’代表换行符。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>Is it a \<br>vaild coment?    <span class="hljs-regexp">//</span>这两行都是注释，因为<span class="hljs-string">&#x27;\&#x27;换行符</span><br></code></pre></td></tr></table></figure>

<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">y</span> <span class="hljs-operator">=</span> x/*p<span class="hljs-comment">;    //error，在编译器看来，注释和其他程序元素是平等的。</span><br><span class="hljs-attribute">y</span> <span class="hljs-operator">=</span> x / *p<span class="hljs-comment">;  //ture</span><br></code></pre></td></tr></table></figure>

<p>漂亮的程序注释：高通</p>
<hr>
<p>接续符：\</p>
<p>接续符是C语言中指示编译器行为的利器。</p>
<p><img src="/image/20190703222040963.png" srcset="/img/loading.gif" lazyload alt="20190703222040963.png"></p>
<p>（1）接续符会将反斜杠剔除，跟在反斜杠后面的字符自动接续到前一行；</p>
<p>（2）在接续单词时，反斜杠之后不能有空格，反斜杠的下一行之前也不能有空格；</p>
<p>（3）接续符适合在定义宏代码块时使用。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#define <span class="hljs-constructor">SWAP(<span class="hljs-params">a</span>,<span class="hljs-params">b</span>)</span> &#123;<span class="hljs-built_in">int</span> temp = a; a = b; b = temp;&#125;    <span class="hljs-comment">//一个宏代码块在c语言里必须定义在同一行，但这样看着麻烦</span><br>#define <span class="hljs-constructor">SWAP(<span class="hljs-params">a</span>,<span class="hljs-params">b</span>)</span>     \<br>&#123;                     \<br>    <span class="hljs-built_in">int</span> temp = a;     \<br>    a = b;            \<br>    b = temp;         \<br>&#125;                                            <span class="hljs-comment">//使用接续符解决这个问题，提升可读性</span><br></code></pre></td></tr></table></figure>

<hr>
<p>转义符</p>
<p>C语言中的转义符（\）主要用于表示无回显字符，也可用于表示常规字符；</p>
<p>无回显字符：键盘上回车键键入后，换行，如何表示换行，（\n）。</p>
<p>当反斜杠作（\）为转义符使用时，必须出现在单引号或双引号之间。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">char enter = <span class="hljs-string">&#x27;\n&#x27;</span>;<br>char* p = <span class="hljs-string">&quot;\141\t\x62&quot;</span>;    <span class="hljs-regexp">//</span>\<span class="hljs-number">141</span>表示某个字符的ASCII码八进制表示<br><br><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, p);<br><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, enter);<br>结果：<br>book@www.<span class="hljs-number">100</span>ask.org:~<span class="hljs-regexp">/Works/</span>Software/C_Test$ ./a.out<br>a    b<br>book@www.<span class="hljs-number">100</span>ask.org:~<span class="hljs-regexp">/Works/</span>Software/C_Test$<br>我们没有在<span class="hljs-string">&quot;&quot;</span>中写上换行，但它依旧换了行，所以可以看出是<span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, enter)这个语句打印了个换行。<br></code></pre></td></tr></table></figure>

<p><img src="/image/20190703222040957.png" srcset="/img/loading.gif" lazyload alt="20190703222040957.png"></p>
<hr>
<p>C语言中的单引号用来表示字符字面量；</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">‘<span class="hljs-keyword">a</span>’表示字符字面量，在内存中占<span class="hljs-number">1</span>个字节<br>‘<span class="hljs-keyword">a</span>’+<span class="hljs-number">1</span>表示<span class="hljs-string">&#x27;a&#x27;</span>的ASCII码加<span class="hljs-number">1</span>，结果为<span class="hljs-string">&#x27;b&#x27;</span><br></code></pre></td></tr></table></figure>

<p>C语言中的双引号用来表示字符串字面量；</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">“<span class="hljs-keyword">a</span>”表示字符串字面量，在内存中占<span class="hljs-number">2</span>个字节<br>“<span class="hljs-keyword">a</span>”+<span class="hljs-number">1</span>表示指针运算，结果指向“<span class="hljs-keyword">a</span>”结束符<span class="hljs-string">&#x27;\0&#x27;</span><br></code></pre></td></tr></table></figure>

<p>例：单引号和双引号的本质</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span>* p1 =  <span class="hljs-number">1</span> ;<br>    <span class="hljs-type">char</span>* p2 = <span class="hljs-string">&#x27;1&#x27;</span>;<br>    <span class="hljs-type">char</span>* p3 = <span class="hljs-string">&quot;1&quot;</span>;            <span class="hljs-comment">//虽然有警告，但还是合法的，并不会影响程序的运行</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s, %s, %s&quot;</span>, p1, p2, p3);    <span class="hljs-comment">//此行发生段错误</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);        <span class="hljs-comment">//‘\n’在第低地址</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br>运行结果为：编译有警告，运行时段错误。<br>发生原因：p1值为<span class="hljs-number">0x1</span>，p2值为<span class="hljs-number">0x31</span>，p3为<span class="hljs-number">0x80484d0</span>，所以在prinrf语句中防问p1,p2地址时发生了段错误，因为在<span class="hljs-number">32</span>位机器中<span class="hljs-number">0x08048000</span>以下的地址时不能随便访问的（<span class="hljs-number">64</span>位机器中是<span class="hljs-number">0x00400000</span>），访问了就会产生段错误，程序里字符串编译得到的地址都会大于这个最低地址<br></code></pre></td></tr></table></figure>

<p>提示：</p>
<p>(1）字符字面量（字符常量）被编译为对应的ASCII码；</p>
<p>(2）字符串字面量（字符串常量）被编译为对应的内存地址；</p>
<p>(3）printf的第一个参数被当成字符串内存地址；</p>
<p>(4）内存的低地址空间不能再程序中任意访问。</p>
<p>例：混淆概念的代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br><br>    <span class="hljs-built_in">char</span> c = <span class="hljs-string">&quot; &quot;</span>;    <br><br>    <span class="hljs-keyword">while</span>( ( c == <span class="hljs-string">&quot;\t&quot;</span> ) || ( c == <span class="hljs-string">&quot; &quot;</span> ) || ( c == <span class="hljs-string">&quot;\n&quot;</span> ) )    <br>    &#123;<br>        scanf(<span class="hljs-string">&quot;%c&quot;</span>, &amp;c);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>运行结果：编译有警告，运行无反应<br>混淆了字符和字符串的概念，程序中的<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;\t&quot;</span>,<span class="hljs-string">&quot;\n&quot;</span>编译后是一个地址值，而c只有一个字节，无法相等，故<span class="hljs-keyword">while</span>不执行。<br>而<span class="hljs-built_in">char</span> c = <span class="hljs-string">&quot; &quot;</span>中，<span class="hljs-string">&quot; &quot;</span>编译后是字符串的内存地址被赋值给变量c，但内存地址占用<span class="hljs-number">4</span>个字节（<span class="hljs-number">32</span>位机器），c只占<span class="hljs-number">1</span>个字节，故赋值后发生截断<br>将程序中所有“”换成<span class="hljs-string">&#x27;&#x27;</span>即完成原先功能<br></code></pre></td></tr></table></figure>

<p>结论：</p>
<p>（1）单引号括起来的单个字符代表整数；（ASCII码）</p>
<p>（2）双引号括起来的字符代表字符指针；（本质上就是内存中的一个地址，字符串编译后就会存储在内存上的某个地址空间里）</p>
<p>（3）C编译器接受字符和字符串的比较，无任何意义；</p>
<p>（4）C编译器允许字符串对字符变量赋值，只能得到错误，因为只能截取赋值。</p>
<hr>
<p>逻辑运算符</p>
<p><img src="/image/6a9fa30f9679f008874084884bb13964.png" srcset="/img/loading.gif" lazyload alt="6a9fa30f9679f008874084884bb13964.png"></p>
<p>结果为：</p>
<p>1 0 0</p>
<p>与的优先级高于或</p>
<p>程序中的短路：</p>
<p>（1）||从左向右开始计算</p>
<p>       -当遇到为真的条件时，停止计算，整个表达式为真。</p>
<p>       -所有条件为假时表达式为假。</p>
<p>（2）&amp;&amp;从左向右开始计算</p>
<p>       -当遇到为假的条件时停止计算，整个表达式为假。</p>
<p>       -所有条件为真时表达式才为真。</p>
<p>逻辑表达式中，&amp;&amp;比||具有更高的优先级。</p>
<p><img src="/image/20190703222219637.png" srcset="/img/loading.gif" lazyload alt="20190703222219637.png"></p>
<p>在&amp;&amp;和||混合运算时，整个表达式被看作||表达式，编译器从左向右开始计算&amp;&amp;表达式，当某个&amp;&amp;表达式的值为真时，停止计算，整个表达式的值为真。</p>
<p>例：程序的短路规则</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> g = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;In f()...\n&quot;</span>);<br>    <br>    <span class="hljs-keyword">return</span> g++;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>( g || <span class="hljs-built_in">f</span>() &amp;&amp; <span class="hljs-built_in">f</span>() )    <span class="hljs-comment">//(ture &amp;&amp; g) || (f() &amp;&amp; f())</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;In if statement:%d\n&quot;</span>, g);<br>    &#125;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;In main():%d\n&quot;</span>, g);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>逻辑非！运算符只认得0：</p>
<p>-碰见0返回1，否则统统返回0。</p>
<p>-只有0才代表假，其余的所有值均代表真。</p>
<hr>
<p>C语言中的位运算符</p>
<p>位运算符直接对bit位进行操作，其效率最高。（比四则运算高很多）</p>
<p><img src="/image/20190703222303284.png" srcset="/img/loading.gif" lazyload alt="20190703222303284.png"></p>
<p>左移和右移注意点：</p>
<p>(1）左操作数必须为整数类型；</p>
<p>       char和short被隐式转换为int后进行移位操作。</p>
<p>(2）右操作数的范围必须为：[0，31]（和机器无关，C语言所规定）</p>
<p>左移-1或者右移32结果不确定，因为标准C没规定其行为，由编译器开发商定义。</p>
<p>(3）左移运算符&lt;&lt;将运算数的二进制左移；</p>
<p>       规则：高位丢弃，低位补0；</p>
<p>(4）右移运算符&gt;&gt;把运算数的二进制位右移；</p>
<p>       规则：高位，补符号位，低位丢弃；（高位补符号位）</p>
<p>右操作数为负数，如何操作？是否正确？取决于编译器。</p>
<p>0x1&lt;&lt; 2 + 3的值会是什么？</p>
<p><img src="/image/20190703222303331.png" srcset="/img/loading.gif" lazyload alt="20190703222303331.png"></p>
<p>编程确认：</p>
<p><img src="/image/20190703222303314.png" srcset="/img/loading.gif" lazyload alt="20190703222303314.png"></p>
<p>分析：B同学对了。</p>
<p>左移-1和编译器有关，gcc实则右移1位。VS为0，BCC为整数最小值。</p>
<p>防错准则：</p>
<p>（1）避免位运算符，逻辑运算符和数学运算符同时出现在一个表达式中；</p>
<p>（2）当位运算符，逻辑运算符和数学运算符需要同时参与运算时，尽量使用括号（）来表达计算次序。</p>
<p>小技巧：</p>
<p>（1）左移n位相当于乘以2的n次方，但效率比数学运算符高；</p>
<p>（2）右移n位相当于除以2的n次方，但效率比数学运算符高；</p>
<p>       （嵌入式开发时，对效率要求高时）</p>
<p>程序分析：（交换两个整型变量a,b的值）</p>
<p>方法1: 使用中间变量t交换</p>
<p>方法2: 使用部分和</p>
<p>a &#x3D; a+b；（若a,b非常大，存在溢出问题）</p>
<p>b &#x3D; a-b；</p>
<p>a &#x3D; a-b；</p>
<p>方法3：异或方法</p>
<p>a &#x3D; a ^ b;</p>
<p>b &#x3D; a ^ b;</p>
<p>a &#x3D; a ^ b;</p>
<p>主要的原理是：</p>
<p>（1）一个变量按位异或自己的结果为0，即：a ^ a &#x3D; 0；</p>
<p>（2）一个变量按位异或0的结果为自己，即：a ^ 0 &#x3D; a；</p>
<p>于是，在上面的三条语句中，语句1可以看做把变量a、b保存到a的存储空间中（当然这只是一种理解方式）；语句2消去了b（原理1），于是剩下了a（原理2），赋值到b的存储空间，此刻，b变量已经得到了a的值；语句3中，原本a变量存储空间内已经同时保存了a、b，此刻，b已经变成了a，所以两个按位异或后，便消去了a（原理1），只剩下了b（原理2），将它赋值给a，至此，交换变量的过程结束。</p>
<p>位运算符与逻辑运算不同：</p>
<p>       (1）位运算没有短路原则，每个操作数都参与运算；</p>
<p>       (2）位运算的结果为整数，而不是0或1；（逻辑运算只有真和假）</p>
<p>       (3）位运算优先级高于逻辑运算优先级；</p>
<p>     （4）位运算的效率高于四则运算和逻辑运算；</p>
<hr>
<p>++和--操作符对应两条汇编指令。</p>
<p>（1）前置：</p>
<p>       变量自增（减）1</p>
<p>       取变量值</p>
<p>（2）后置</p>
<p>       取变量值</p>
<p>       变量自增（减）1</p>
<p><img src="/image/20190703222349679.png" srcset="/img/loading.gif" lazyload alt="20190703222349679.png"></p>
<p>gcc结果：<img src="/image/20190703222349697.png" srcset="/img/loading.gif" lazyload alt="20190703222349697.png"></p>
<p>，vs结果：<img src="/image/20190703222349691.png" srcset="/img/loading.gif" lazyload alt="20190703222349691.png"></p>
<p>vs和gcc不同（灰色地带）</p>
<p>结果分析：vs先加后自增。</p>
<p>为什么结果不确定？</p>
<p>（1）C语言中只规定了++和--对应指令的相对执行程序；</p>
<p>（2）++和--对应的汇编指令不一定连续运行；</p>
<p>（3）在混合运算中，++和--的汇编指令可能被打断执行；</p>
<p>++和--参与混合运算的结果是不确定的。</p>
<p>笔试中的奇葩题：</p>
<p><img src="/image/20190703222349716.png" srcset="/img/loading.gif" lazyload alt="20190703222349716.png"></p>
<p>编译器究竟如何编译？</p>
<p><img src="/image/20190703222349725.png" srcset="/img/loading.gif" lazyload alt="20190703222349725.png"></p>
<p>int j &#x3D; ++i+++i+++i;  &#x2F;&#x2F;该行出错  1++  这样不合法</p>
<p>贪心法：++和--的阅读技巧</p>
<p>（1）编译器处理的每个符号应该尽可能多的包含字符；</p>
<p>（2）编译器从左向右的顺序一个一个读字符，尽可能多的读入字符；</p>
<p>（3）当读入的字符不可能和已读入的字符组合成合法符号，暂停读入，处理已读入字符；</p>
<p>注意：</p>
<p>（1）空格可以作为C语言中一个完整符号的休止符；</p>
<p>（2）编译器读入空格后立即对之前读入的符号进行处理；（尽量使用空格）</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">b</span> <span class="hljs-operator">=</span> b/*p<span class="hljs-comment">;</span><br><span class="hljs-attribute">b</span> <span class="hljs-operator">=</span> b / *p<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<hr>
<p>三目运算符(a ? b : c)</p>
<p>三目运算符(a ? b : c)可以作为逻辑运算的载体，可以简单的代替if else语句；</p>
<p>规则：当a的值为真时，返回b的值；否则返回c的值。</p>
<p><img src="/image/20190703222432572.png" srcset="/img/loading.gif" lazyload alt="20190703222432572.png"></p>
<p>三目运算符不可以当作左值使用。三目运算符返回值为一个值，而不是变量本身。</p>
<p>小技巧：</p>
<p>这里可以用地址来解决，因为变量的地址就是一个值。</p>
<p>*（a &lt; b ? &amp;a : &amp;b）&#x3D; 3;</p>
<p>三目运算符(a ? b : c)的返回类型：</p>
<p>1）通过隐式类型转换返回b和c中的较高类型；</p>
<p>2）当b和c不能隐式转换到同一类型时，编译出错。</p>
<p><img src="/image/20190703222432593.png" srcset="/img/loading.gif" lazyload alt="20190703222432593.png"></p>
<p>最后一行编译不通过。</p>
<p>逗号表达式</p>
<p>1）逗号表达式是C语言中的“粘贴剂”；</p>
<p>2）逗号表达式用于将多个子表达式连接为一个表达式；</p>
<p>3）逗号表达式的值为最后一个子表达式的值；</p>
<p>4）逗号表达式中的前N-1个子表达式可以没有返回值；</p>
<p>5）逗号表达式按照从左向右的顺序计算每个子表达式的值。</p>
<p>下面的程序输出什么？为什么？</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs perl">void hello()<br>&#123;<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;Hello\n&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">int</span> a[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>] = &#123;<br>        (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),        <span class="hljs-regexp">//</span>此为逗号表达式，值为<span class="hljs-number">2</span><br>        (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>),        <span class="hljs-regexp">//</span>若（）改为&#123;&#125;，则为正确二维数组初始化<br>        (<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>)<br>    &#125;;<br>    <br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">while</span>( i &lt; <span class="hljs-number">5</span> )<br>        <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;i = %d\n&quot;</span>, i),        <span class="hljs-regexp">//</span>注意此为逗号表达式，故虽然<span class="hljs-keyword">while</span>只作用于后面一条语句，也会执行这三条语句<br><br>    hello(),<br><br>    i++;<br><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; i++)<br>    &#123;<br>         <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">3</span>; j++)<br>        &#123;<br>            <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a[%d][%d] = %d\n&quot;</span>, i, j, a[i][j]);<br>        &#125;   <br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>  int a[3][3] &#x3D; {</p>
<p>        (0, 1, 2),   &#x2F;&#x2F;只有2</p>
<p>        (3, 4, 5),   &#x2F;&#x2F;只有5</p>
<p>        (6, 7, 8)   &#x2F;&#x2F;只有8</p>
<p>               };      &#x2F;&#x2F;前三个元素初始化为2,5,8。</p>
<p>小结：</p>
<p>1）三目运算符返回变量的值，而不是变量本身；</p>
<p>2）三目运算符通过隐式类型转换确认返回值类型；</p>
<p>3）逗号表达式按照从左向右的顺序计算子表达式的值；</p>
<p>4）逗号表达式的值为最后一个子表达式的值；</p>
<p>例：用一行代码实现strlen</p>
<p><img src="/image/20190703222432594.png" srcset="/img/loading.gif" lazyload alt="20190703222432594.png"></p>
<hr>
<p>C语言如何编译语言程序。对编译器的了解程度决定代码的产品质量</p>
<p><img src="/image/20190703222510862.png" srcset="/img/loading.gif" lazyload alt="20190703222510862.png"></p>
<p><img src="/image/20190703222510886.png" srcset="/img/loading.gif" lazyload alt="20190703222510886.png"></p>
<p>file.i 中间代码</p>
<p>file.s 汇编文件</p>
<p>file.o 二进制文件</p>
<p>预编译（文本处理工作）</p>
<p>1）处理所有的注释，用空格代替；</p>
<p>2）将所有的#define删除，并且展开所有的宏定义；</p>
<p>3）处理条件编译命令，#if，#ifdef，#elif，#else，#endif</p>
<p>4）处理#include，展开被包含的文件；</p>
<p>5）保留编译器需要使用的#pragma命令；</p>
<p>预处理指令示例：</p>
<p>gcc –E file.c –o file.i</p>
<p>编译</p>
<p>1）对预处理文件进行词法分析，语法分析和语义分析；</p>
<p>       a&gt; 词法分析：分析关键字，指示符，立即数等是否合法；</p>
<p>       b&gt; 语法分析：分析表达式是否遵循语法原则；</p>
<p>       c&gt; 语义分析：在语法分析的基础上进一步分析表达式是否合法；</p>
<p>分析结束后进行代码优化生成相应的汇编代码文件；</p>
<p>编译指令示例：</p>
<p>gcc –S file.i –o file.s</p>
<p>汇编（相对编译器工作简单）</p>
<p>1）汇编器将汇编代码转变为机器的可以执行代码；</p>
<p>2）每条汇编语句几乎都对应一条机器指令；</p>
<p>汇编指令示例：</p>
<p>gcc –c file.s –o file.o</p>
<p>小结:</p>
<p>编译过程分为预处理，编译，汇编和链接四个阶段。</p>
<p>1）预处理：处理注释，宏以及#开头的符号；</p>
<p>2）编译：进行词法分析，语法分析和语义分析；</p>
<p>3）汇编：将汇编代码翻译为机器指令的目标文件；</p>
<hr>
<p>工程中的每个C语言源文件被编译后生产目标文件，这些文件如何生成最终的可执行程序？</p>
<p>链接器的意义：</p>
<p>链接器的主要作用是把各个模块之间相互引用的部分处理好，使得模块之间能够争取的衔接，从而得到可执行程序。</p>
<p><img src="/image/20190703222554814.png" srcset="/img/loading.gif" lazyload alt="20190703222554814.png"></p>
<p>静态链接</p>
<p>由链接器在链接时将库的内容直接加入到可执行程序中。</p>
<p><img src="/image/20190703222554831.png" srcset="/img/loading.gif" lazyload alt="20190703222554831.png"></p>
<p>在Linux静态库下的创建和使用：</p>
<p>1）编译静态库源码：gcc –c lib.c –o <strong>lib.o</strong>   （目标文件）</p>
<p>2）生成静态库文件：<strong>ar</strong> –q lib.a lib.o     （将lib.a后面的所有文件打包成一个档案文件，这个档案文件又叫静态库）</p>
<p>3）使用静态库编译：gcc main.c lib.a –o main.out （lib.a相当于一个档案包，叫做静态库）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* main.c */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span>* <span class="hljs-title">name</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Name:%s\n&quot;</span>, <span class="hljs-built_in">name</span>());<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Result:%d\n&quot;</span>, <span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>));<br><br>&#125;<br><br><span class="hljs-comment">/* lib.c */</span><br><span class="hljs-function"><span class="hljs-type">char</span>* <span class="hljs-title">name</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Static Lib&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br>将lib.c制作成一个静态库：<br>gcc –c lib.c –o lib.o<br>ar –q lib.a lib.o<br><br>这时直接编译main.c<br>gcc main.c<br>报错，找不到<span class="hljs-built_in">name</span>()和<span class="hljs-built_in">add</span>();<br><br>使用静态库重新编译<br>gcc main.c lib.a –o main.out<br>编译成功，运行成功<br><br>此时删除除main.out所有文件<br>运行依旧成功<br></code></pre></td></tr></table></figure>

<p>动态链接（运行时再到动态库中查找内容）</p>
<p>1）可执行程序在运行时才动态加载库进行链接；</p>
<p>2）库的内容不会进入可执行程序当中。</p>
<p><img src="/image/20190703222554851.png" srcset="/img/loading.gif" lazyload alt="20190703222554851.png"></p>
<p>sub1和sub2是动态库暴露出来告诉编译器所能提供的内容（有用的部分）</p>
<p>在Linux动态库下的创建和使用：</p>
<p>1）编译动态库源码：gcc –shared dlib.c –o <strong>dlib.so</strong>   （目标文件）</p>
<p>2）使用动态库编译：gcc main.c –ldl –o main.out</p>
<p>3）关键系统调用：</p>
<p>       a&gt; dlopen：打开动态库文件</p>
<p>       b&gt; dlsym：查找动态库中的函数并返回调用地址</p>
<p>       c&gt; dlclose：关闭动态库文件</p>
<p><img src="/image/20190703222554873.png" srcset="/img/loading.gif" lazyload alt="20190703222554873.png"></p>
<p><img src="/image/20190703222554853.png" srcset="/img/loading.gif" lazyload alt="20190703222554853.png"></p>
<p>小结：</p>
<p>1）链接是指将目标文件最终链接为可执行程序；</p>
<p>2）根据链接方式的不同，链接过程可以分为：</p>
<p>       a&gt; 静态链接：目标文件直接链接进入可执行程序；（适用于小程序）</p>
<p>       b&gt; 动态链接：在程序启动后才动态加载目标文件；（部分更新应用程序）</p>
<hr>
<p>C语言中的宏定义</p>
<p>#define是预处理处理的单元实体之一</p>
<p>#define定义的宏可以出现在程序的任意位置</p>
<p>#define定义之后的代码都可以使用这个宏</p>
<p>#define定义的宏常量可以直接使用</p>
<p>#define定义的宏常量本质为字面量（字面量不占用内存）</p>
<p>问：以下宏定义是正确的吗</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* test.c */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ERROR -1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PATH1 <span class="hljs-string">&quot;D:\test\test.c&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PATH2 D:\test\test.c    <span class="hljs-comment">//宏用来替代路径很好用</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PATH3 D:\test\    <span class="hljs-comment">/* 由于&#x27;\&#x27;出现在宏定义的最后一个字符，因此&#x27;\&#x27;变为了接续符 */</span></span><br>test.<span class="hljs-function">c</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> err = ERROR;<br>    <span class="hljs-type">char</span>* p1 = PATH1;<br>    <span class="hljs-type">char</span>* p2 = PATH2;<br>    <span class="hljs-type">char</span>* p3 = PATH3;<br>&#125;<br><br><span class="hljs-comment">/* test.i */</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;built-in&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;command-line&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> err = <span class="hljs-number">-1</span>;<br>    <span class="hljs-type">char</span>* p1 = <span class="hljs-string">&quot;D:\test\test.c&quot;</span>;<br>    <span class="hljs-type">char</span>* p2 = D:\test\test.c;<br>    <span class="hljs-type">char</span>* p3 = D:\testtest.c;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>预处理器只进行文本替换是不会进行语法检查的，语法检查由编译器执行。但替换后编译器发现不符合语法规则，直接报错。</p>
<p>答：宏定义是正确的，但只能通过预编译，不能通过编译。</p>
<p>宏定义表达式</p>
<p>#define表达式的使用类似函数调用</p>
<p>#define表达式可以比函数更强大</p>
<p>#define表达式比函数更容易出错：因为预处理器直接进行文本替换，结果就和我们预想的不一样</p>
<p>下面的宏定义表达式正确吗？</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">/* test.c */</span><br>#define <span class="hljs-constructor">_SUM_(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span> (a) + (b)<br>#define <span class="hljs-constructor">_MIN_(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span> ((a) &lt; (b) ? (a) : (b))<br>#define <span class="hljs-constructor">_DIM_(<span class="hljs-params">a</span>)</span> sizeof(a)/sizeof(*a)    <span class="hljs-comment">//求一个数组的大小</span><br><br><span class="hljs-built_in">int</span> main<span class="hljs-literal">()</span><br>&#123;<br>    <span class="hljs-built_in">int</span> a = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">int</span> b = <span class="hljs-number">2</span>;<br>    <span class="hljs-built_in">int</span> c<span class="hljs-literal">[<span class="hljs-number">4</span>]</span> = &#123;<span class="hljs-number">0</span>&#125;;<br><br>    <span class="hljs-built_in">int</span> s1 = <span class="hljs-constructor">_SUM_(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span>;<br>    <span class="hljs-built_in">int</span> s2 = <span class="hljs-constructor">_SUM_(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span><span class="hljs-operator"> * </span><span class="hljs-constructor">_SUM_(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span>;<br>    <span class="hljs-built_in">int</span> m = <span class="hljs-constructor">_MIN_(<span class="hljs-params">a</span><span class="hljs-operator">++</span>, <span class="hljs-params">b</span>)</span>;<br>    <span class="hljs-built_in">int</span> d = <span class="hljs-constructor">_DIM_(<span class="hljs-params">c</span>)</span>;<br><br>     printf(<span class="hljs-string">&quot;s1 = %d\n&quot;</span>, s1);    <span class="hljs-comment">//3</span><br>     printf(<span class="hljs-string">&quot;s2 = %d\n&quot;</span>, s2);    <span class="hljs-comment">//5</span><br>     printf(<span class="hljs-string">&quot;m = %d\n&quot;</span>, m);      <span class="hljs-comment">//2</span><br>     printf(<span class="hljs-string">&quot;d = %d\n&quot;</span>, d);      <span class="hljs-comment">//4</span><br><br>    return <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* test.i */</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;built-in&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;command-line&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br><br><span class="hljs-built_in">int</span> main<span class="hljs-literal">()</span><br>&#123;<br>    <span class="hljs-built_in">int</span> a = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">int</span> b = <span class="hljs-number">2</span>;<br>    <span class="hljs-built_in">int</span> c<span class="hljs-literal">[<span class="hljs-number">4</span>]</span> = &#123;<span class="hljs-number">0</span>&#125;;<br><br>    <span class="hljs-built_in">int</span> s1 = (a) + (b);<br>    <span class="hljs-built_in">int</span> s2 = (a) + (b)<span class="hljs-operator"> * </span>(a) + (b);        <span class="hljs-comment">//所以说比函数更容易出错</span><br>    <span class="hljs-built_in">int</span> m = ((a++) &lt; (b) ? (a++) : (b));   <span class="hljs-comment">//所以说比函数更容易出错</span><br>    <span class="hljs-built_in">int</span> d = sizeof(c)/sizeof(*c);<br><br>    return <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>宏表达式和函数的对比</p>
<p>宏表达式被预处理器处理，编译器不知道宏表达式的存在</p>
<p>宏表达式用“实参”完全替代形参（文本替换），不进行任何运算</p>
<p>优势：宏表达式没有任何的“调用”开销，函数则需要参数布栈返回值的返回等开销</p>
<p>宏表达式中不能出现递归定义，函数可以又递归函数</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#define <span class="hljs-constructor">_SUM_(<span class="hljs-params">n</span>)</span> ((n&gt;<span class="hljs-number">0</span>)?(<span class="hljs-constructor">_SUM_(<span class="hljs-params">n</span>-1)</span>+n):<span class="hljs-number">0</span>)    <span class="hljs-comment">//error</span><br><span class="hljs-built_in">int</span> s = <span class="hljs-constructor">_SUM_(10)</span>;<br></code></pre></td></tr></table></figure>

<p>有趣的问题</p>
<p>问：宏定义的常量或表达式是否有作用域限制</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/* test.c */</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">def</span>()</span><br>&#123;<br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> PI 3.1415926</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> AREA(r) r * r * PI</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">double</span> <span class="hljs-title">area</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> r</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> AREA(r);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    <span class="hljs-built_in">double</span> r = area(<span class="hljs-number">5</span>);<br><br>    <span class="hljs-comment">// printf(&quot;PI = %f\n&quot;, PI);</span><br>    <span class="hljs-comment">// printf(&quot;d = 5; a = %f\n&quot;, r);</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>答：对于宏而言，作用域是没有限制的。</p>
<p>作用域的概念是针对变量和函数的，不针对宏，因为宏是被预处理所处理，编译器根本不知道宏定义的存在，所以也无法把作用域的概念用在宏定义上</p>
<p>强大的内置宏</p>
<p><img src="/image/Slide10.PNG" srcset="/img/loading.gif" lazyload alt="Slide10.PNG"></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#<span class="hljs-keyword">include</span> &lt;stdio.h&gt;<br>#<span class="hljs-keyword">include</span> &lt;malloc.h&gt;<br><br>#define <span class="hljs-constructor">MALLOC(<span class="hljs-params">type</span>, <span class="hljs-params">x</span>)</span> (<span class="hljs-keyword">type</span>*)malloc(sizeof(<span class="hljs-keyword">type</span>)*x)    <span class="hljs-comment">//用来向堆空间申请一个数组</span><br><br>#define <span class="hljs-constructor">FREE(<span class="hljs-params">p</span>)</span> (free(p), p=NULL)    <span class="hljs-comment">//释放堆空间，指针指向空</span><br><br><span class="hljs-comment">/* 打印当前时间，当前文件名，当前行号，字符串s */</span><br>#define <span class="hljs-constructor">LOG(<span class="hljs-params">s</span>)</span> printf(<span class="hljs-string">&quot;[%s] &#123;%s:%d&#125; %s \n&quot;</span>, __DATE__, __FILE__, __LINE__, s)<br><br><span class="hljs-comment">/* 一个for循环 */</span><br>#define <span class="hljs-constructor">FOREACH(<span class="hljs-params">i</span>, <span class="hljs-params">m</span>)</span> <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;m; i++)<br>#define BEGIN &#123;<br>#define END   &#125;<br><br><span class="hljs-built_in">int</span> main<span class="hljs-literal">()</span><br>&#123;<br>    <span class="hljs-built_in">int</span> x = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">int</span>* p = <span class="hljs-constructor">MALLOC(<span class="hljs-params">int</span>, 5)</span>;    <span class="hljs-comment">//C语言是不能将一个类型作为参数调用的</span><br>    <br>    <span class="hljs-constructor">LOG(<span class="hljs-string">&quot;Begin to run main code...&quot;</span>)</span>;    <span class="hljs-comment">//日志宏</span><br>    <br>    <span class="hljs-constructor">FOREACH(<span class="hljs-params">x</span>, 5)</span><br>    BEGIN<br>        p<span class="hljs-literal">[<span class="hljs-identifier">x</span>]</span> = x;<br>    END<br>    <br>    <span class="hljs-constructor">FOREACH(<span class="hljs-params">x</span>, 5)</span><br>    BEGIN<br>        printf(<span class="hljs-string">&quot;%d\n&quot;</span>, p<span class="hljs-literal">[<span class="hljs-identifier">x</span>]</span>);<br>    END<br>    <br>    <span class="hljs-constructor">FREE(<span class="hljs-params">p</span>)</span>;<br>    <br>    <span class="hljs-constructor">LOG(<span class="hljs-string">&quot;End&quot;</span>)</span>;    <span class="hljs-comment">//日志宏</span><br>    <br>    return <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>预处理器直接对宏进行文本替换</p>
<p>宏使用的参数不会进行求值和运算</p>
<p>预处理器不会对宏定义进行语法检查，所有define出来的宏都是正确的</p>
<p>宏定义时出现的语法错误只能被编译器检测</p>
<p>宏定义的效率高于函数调用</p>
<p>宏的使用会带来一定的副作用</p>
<p>问题：什么时候要用宏，什么时候用函数？</p>
<hr>
<p>条件编译使用分析</p>
<p>使用一拨人开发一份代码，根据一份代码产生高中低三种产品</p>
<p>1.基本概念</p>
<p>条件编译的行为类似于C语言中的if..else…</p>
<p>条件编译是预编译指示命令,用于控制是否编译某段代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> C 1</span><br><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span>* s;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span>( C == 1 )</span><br>        s = <span class="hljs-string">&quot;This is first printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>        s = <span class="hljs-string">&quot;This is second printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-comment">// printf(&quot;%s&quot;, s);</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* test.i */</span><br><span class="hljs-meta"># 1 &quot;test.c&quot;</span><br><span class="hljs-meta"># 1 &quot;&lt;built-in&gt;&quot;</span><br><span class="hljs-meta"># 1 &quot;&lt;command-<span class="hljs-keyword">line</span>&gt;&quot;</span><br><span class="hljs-meta"># 1 &quot;test.c&quot;</span><br><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span>* s;<br>        s = <span class="hljs-string">&quot;This is first printf...\n&quot;</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>通过#if #else指示预处理器保存哪段代码</p>
<p>2.条件编译的本质</p>
<p>预编译器根据条件编译指令有选择的删除代码，到编译器时，编译器不知道代码分支的存在</p>
<p>if..else…语句在运行期进行分支判断；条件编译指令在预编译期进行分支判断</p>
<p>可以通过命令行定义宏</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* 在函数中并不定义宏C */</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* s;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span>( C == 1 )</span><br>        s = <span class="hljs-string">&quot;This is first printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>        s = <span class="hljs-string">&quot;This is second printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, s);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/* 格式 */</span><br>gcc -Dmacro=value file.c <br><br><span class="hljs-regexp">/* 在命令行中定义宏 */</span><br>gcc -DC=<span class="hljs-number">1</span> test.c<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* 定义C作为宏标识符 */</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* s;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> C</span><br>        s = <span class="hljs-string">&quot;This is first printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>        s = <span class="hljs-string">&quot;This is second printf...\n&quot;</span>;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-comment">//printf(&quot;%s&quot;, s);</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3.#include的本质</p>
<p>（1）</p>
<p>#include的本质是将已经存在的文件内容嵌入到当前文件中</p>
<p>#include的间接包含同样会产生嵌入文件内容的操作</p>
<p><img src="/image/0d02d40684aeee981de901baa4201f04.png" srcset="/img/loading.gif" lazyload alt="0d02d40684aeee981de901baa4201f04.png"></p>
<p>问题:间接包含同一个头文件是否会产生编译错误?</p>
<p>答：会，因为重复包含造成重复定义</p>
<p>（2）条件编译可以解决头文件重复包含的编译错误</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#ifndef_ HEADER_ _FILE_ H_</span><br><span class="hljs-comment">#define_ HEADER_ FILE_ _H_</span><br><span class="hljs-regexp">//</span> source code<br><span class="hljs-comment">#endif</span><br></code></pre></td></tr></table></figure>

<p>4.条件编译的意义</p>
<p>条件编译使得我们可以按不同的条件编译不同的代码段，因而可以产生不同的目标代码</p>
<p>#if.. #else… #endif被预编译器处理,而if.. .else..语句被编译器处理,必然被编译进目标代码</p>
<p>实际工程中条件编译主要用于一下两种情况:</p>
<p>-不同的产品线共用一份代码</p>
<p>-区分编译产品的调试版和发布版</p>
<p>产品线区分及调试代码应用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* product.h </span><br><span class="hljs-comment"> * 文件指示了这是调试版的高端产品</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DEBUG 1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HIGH  1</span><br><br><span class="hljs-comment">/* test.c */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;product.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> DEBUG    <span class="hljs-comment">//指示当前编译出来的可执行程序是调试版还是可发行版</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG(s) printf(<span class="hljs-string">&quot;[%s:%d] %s\n&quot;</span>, __FILE__, __LINE__, s)</span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG(s) NULL</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HIGH    <span class="hljs-comment">//指示当前编译出来的可执行程序是高端产品还是低端产品</span></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is the high level product!\n&quot;</span>);<br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">LOG</span>(<span class="hljs-string">&quot;Enter main() ...&quot;</span>);<br>    <br>    <span class="hljs-built_in">f</span>();<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1. Query Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2. Record Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3. Delete Information.\n&quot;</span>);<br>    <br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> HIGH    <span class="hljs-comment">//高端产品才有功能4，5</span></span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Mannul Service.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;6. Exit.\n&quot;</span>);<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. Exit.\n&quot;</span>);<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <br>    <span class="hljs-built_in">LOG</span>(<span class="hljs-string">&quot;Exit main() ...&quot;</span>);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>通过编译器命令行能够定义预处理器使用的宏</p>
<p>条件编译可以避免重复包含头同一个头文件</p>
<p>条件编译是在工程开发中可以区别不同产品线的代码</p>
<p>条件编译可以定义产品的发布版和调试版</p>
<hr>
<p><strong>#error和#line使用分析</strong></p>
<p>1.#error的用法</p>
<p>（1）#error用于生成一个编译错误消息</p>
<p>用法</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sas">#<span class="hljs-keyword">error</span> <span class="hljs-keyword">message</span><br><span class="hljs-keyword">message</span>不需要用双弓|号包围<br></code></pre></td></tr></table></figure>

<p>#error编译指示字用于自定义程序员特有的编译错误消息（一些不影响程序运行但不符合我们预期的错误）。</p>
<p>类似的, #warning用于生成编译警告信息。</p>
<p>（2）#error是一种预编译器指示字，可用于提示编译条件是否满足</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#ifndef_ cplusplus</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">error</span> This file should be processed with C+ + compiler.</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>编译过程中的任意错误信息意味着无法生成最终的可执行程序。</p>
<p>例1：#error的预处理</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __cplusplus</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">error</span> This file should be processed with C++ compiler.    <span class="hljs-comment">//错误使用C语言编译C++代码，通过#error报错</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CppClass</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> m_value;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">CppClass</span>()<br>    &#123;<br>        <br>    &#125;<br>    ~<span class="hljs-built_in">CppClass</span>()<br>    &#123;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>例2：#error在条件编译中的应用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* 高中低端产品 */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a low level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a middle level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a high level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">f</span>();<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1. Query Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2. Record Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3. Delete Information.\n&quot;</span>);<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Mannul Service.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;6. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">gcc -DPRODUCT=<span class="hljs-number">2</span> test.c    <br><span class="hljs-regexp">/* 若不编译PRODUCT这个宏，编译虽然通过，但不仅没有达到我们想要的结果，还因为编译成功并没有错误信息导致用户误判程序完全正常 */</span><br></code></pre></td></tr></table></figure>

<p>可以这么修改</p>
<p>①使用#error</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a low level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a middle level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a high level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">error</span> The <span class="hljs-string">&quot;PRODUCT&quot;</span> is NOT defined!</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">f</span>();<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1. Query Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2. Record Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3. Delete Information.\n&quot;</span>);<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Mannul Service.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;6. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">error</span> The <span class="hljs-string">&quot;PRODUCT&quot;</span> is NOT defined!</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不在命令中定义宏PRODUCT，则报错，无法生成可执行程序。</p>
<p>②使用#warning</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a low level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a middle level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is a high level product!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">warning</span> The <span class="hljs-string">&quot;PRODUCT&quot;</span> is NOT defined!</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">f</span>();<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1. Query Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2. Record Information.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3. Delete Information.\n&quot;</span>);<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( PRODUCT == 1 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 2 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ( PRODUCT == 3 )</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4. High Level Query.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5. Mannul Service.\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;6. Exit.\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">warning</span> The <span class="hljs-string">&quot;PRODUCT&quot;</span> is NOT defined!</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不在命令中定义宏PRODUCT，则报警告，可执行程序依旧生成。</p>
<p>2.#line的用法</p>
<p>#line用于强制指定新的行号和编译文件名,并对源程序的代码重新编号。</p>
<p>用法</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#line number fil ename</span><br>filename可省略<br></code></pre></td></tr></table></figure>

<p>#line编译指示字的本质是重定义_ LINE_（行号） 和_ FILE_（文件名）</p>
<p>最初的C语言程序员都比较小，程序员都习惯所有代码写在一个文件中，后来逐渐开始合作。一个程序员a写a.c，另一个写b.c，写完后再放到一个程序中，但程序要出错后需要改错，谁写的谁解决，于是出现以下类似的代码。</p>
<p>例3：#line的使用</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs d">#include &lt;stdio.h&gt;<br><br><span class="hljs-comment">// The code section is written by A.</span><br><span class="hljs-comment">// Begin</span><br><span class="hljs-meta">#line 1 &quot;a.c&quot;</span><br><br><span class="hljs-comment">// End</span><br><br><span class="hljs-comment">// The code section is written by B.</span><br><span class="hljs-comment">// Begin</span><br><span class="hljs-meta">#line 1 &quot;b.c&quot;</span><br><br><span class="hljs-comment">// End</span><br><br><span class="hljs-comment">// The code section is written by Delphi.</span><br><span class="hljs-comment">// Begin</span><br><span class="hljs-meta">#line 1 &quot;delphi_tang.c&quot;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    printf(<span class="hljs-string">&quot;%s : %d\n&quot;</span>, <span class="hljs-keyword">__FILE__</span>, <span class="hljs-keyword">__LINE__</span>);<br>    <br>    printf(<span class="hljs-string">&quot;%s : %d\n&quot;</span>, <span class="hljs-keyword">__FILE__</span>, <span class="hljs-keyword">__LINE__</span>);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">// End</span><br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>#error用于自定义一-条编译错误信息</p>
<p>#warning用于自定义一条编译警告信息</p>
<p>#error和#warning常应用于条件编译的情形</p>
<p>#line用于强制指定新的行号和编译文件名</p>
<hr>
<p><strong>#pragma使用分析</strong></p>
<p>1.简介</p>
<p>#pragma用于指示编译器完成一些特定的动作</p>
<p>#pragma所定义的很多指示字是编译器特有的，在不同的编译器间是不可移植的</p>
<ul>
<li>预处理器将忽略它不认识的#pragma指令</li>
<li>不同的编译器可能以不同的方式解释同一条#pragma指令</li>
</ul>
<p>一般用法:#pragma parameter</p>
<p>注:不同的parameter参数语法和意义各不相同.</p>
<p>2.#pragma message</p>
<p>message参数在大多数的编译器中都有相似的实现</p>
<p>message参数在编译时输出消息到编译输出窗口中</p>
<p>message用于条件编译中可提示代码的版本信息</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(ANDROID20)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> message(&quot;Compile Android SDK 2.0...&quot;)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> VERSION &quot;Android 2.0”</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>与#error和#warning不同，#pragma message仅仅代表一条编译消息，不代表程序错误。</p>
<p>例：#pragma message使用实例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(ANDROID20)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> message(<span class="hljs-string">&quot;Compile Android SDK 2.0...&quot;</span>)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> VERSION <span class="hljs-string">&quot;Android 2.0&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> defined(ANDROID23)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> message(<span class="hljs-string">&quot;Compile Android SDK 2.3...&quot;</span>)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> VERSION <span class="hljs-string">&quot;Android 2.3&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> defined(ANDROID40)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> message(<span class="hljs-string">&quot;Compile Android SDK 4.0...&quot;</span>)</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> VERSION <span class="hljs-string">&quot;Android 4.0&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">error</span> Compile Version is not provided!</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, VERSION);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/* gcc： */</span>    <br><span class="hljs-comment">#pragma message：Compile Android SDK 4.0...</span><br><span class="hljs-regexp">/* vc4.0 */</span><br>Compile Android SDK <span class="hljs-number">4.0</span>...<br><span class="hljs-regexp">/* bcc */</span><br>Compile Android SDK <span class="hljs-number">2.3</span>...<br></code></pre></td></tr></table></figure>

<p>#pragma message在不同的编译器实现方式不同</p>
<p>3.#pragma once</p>
<p>#pragma once用于保证头文件只被编译一次</p>
<p>#pragma once是编译器相关的,不一定被支持</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#ifndef_ HEADER FILE_ H_</span><br><span class="hljs-comment">#define_ HEADER_ FILE_ H_</span><br><span class="hljs-regexp">//</span> source code<br><span class="hljs-comment">#endif</span><br></code></pre></td></tr></table></figure>

<p>VS</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br></code></pre></td></tr></table></figure>

<p>这两种方式有什么区别?</p>
<p>#ifdef通过宏的方式来判断文件是否被包含，虽然最后内容只包含一次，但预处理器还是处理了多次，每有个文件就要处理一次，</p>
<p>#pragma once直接告诉预处理器只编译一次，一次include后再include预处理器就不会处理了。</p>
<p>例：#pragma once使用分析</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;global.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;global.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;g_value = %d\n&quot;</span>, g_value);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">gcc、vc2010支持<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br>bcc不支持<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br></code></pre></td></tr></table></figure>

<p>可以这样写就结合#ifdef和#pragma的优点，既保证了编译效率，又保证了一致性</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> _GLOBAL_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GLOBAL_H_</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><br><span class="hljs-type">int</span> g_value = <span class="hljs-number">1</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>4.#pragma pack</p>
<p>什么是内存对齐?</p>
<ul>
<li>不同类型的数据在内存中按照一定的规则排列</li>
<li>而不一定是顺序的一一个接一个的排列</li>
</ul>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs abnf">strust Test1<br>&#123;<br>    char c1<span class="hljs-comment">;</span><br>    short s<span class="hljs-comment">;</span><br>    char c2<span class="hljs-comment">;</span><br>    int i<span class="hljs-comment">;</span><br>&#125;<span class="hljs-comment">;</span><br>strust Test2<br>&#123;<br>    char c1<span class="hljs-comment">;</span><br>    char c2<span class="hljs-comment">;</span><br>    short s<span class="hljs-comment">;</span><br>    int i<span class="hljs-comment">;</span><br>&#125;<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>Testl和Test2所占的内存空间是否相同?</p>
<p>不同，Test1占用12，Test2占用8</p>
<p><img src="/image/81457ebe9ab393c3beb307a562a51431.png" srcset="/img/loading.gif" lazyload alt="81457ebe9ab393c3beb307a562a51431.png"></p>
<p>为什么需要内存对齐?</p>
<ul>
<li>CPU对内存的读取不是连续的,而是分成块读取的,块的大小只能是1、2、4、8、16…字节</li>
<li>当读取操作的数据未对齐,则需要两次总线周期来访问内存,性能会大打折扣，因此CPU保证用尽量少的CPU周期将它们从内存读进来</li>
<li>某些硬件平台只能从规定的相对地址处读取特定类型的数据,否则产生硬件异常</li>
</ul>
<p>#pragma pack用于指定内存对齐方式</p>
<p>#pragma pack能够改变编译器的默认对齐方式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(1)</span><br>strust Test1<br>&#123;<br>    <span class="hljs-type">char</span> c1;<br>    <span class="hljs-type">short</span> s;<br>    <span class="hljs-type">char</span> c2;<br>    <span class="hljs-type">int</span> i;<br>&#125;;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack()</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(1)</span><br>strust Test2<br>&#123;<br>    <span class="hljs-type">char</span> c1;<br>    <span class="hljs-type">short</span> s;<br>    <span class="hljs-type">char</span> c2;<br>    <span class="hljs-type">int</span> i;<br>&#125;;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack()</span><br></code></pre></td></tr></table></figure>

<p>sizeof(struct Test1) &#x3D; 8</p>
<p>sizeof(struct Test2) &#x3D; 8</p>
<p>struct占用的内存大小对齐规则</p>
<ul>
<li>第一个成员起始于0偏移处</li>
<li>每个成员按其类型大小和pack参数中较小的一个进行对齐<ul>
<li>偏移地址必须能被对齐参数整除</li>
<li>结构体成员的大小取其内部长度最大的数据成员作为其大小</li>
</ul>
</li>
<li>结构体总长度必须为所有对齐参数的整数倍</li>
</ul>
<p>编译器在默认情况下按照4字节对齐，即#pragma pack(4)。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(2)</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Test1</span><br>&#123;<br>    <span class="hljs-type">char</span>  c1;<br>    <span class="hljs-type">short</span> s;<br>    <span class="hljs-type">char</span>  c2;<br>    <span class="hljs-type">int</span>   i;<br>&#125;;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack()</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(4)</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Test2</span><br>&#123;<br>    <span class="hljs-type">char</span>  c1;<br>    <span class="hljs-type">char</span>  c2;<br>    <span class="hljs-type">short</span> s;<br>    <span class="hljs-type">int</span>   i;<br>&#125;;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack()</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sizeof(Test1) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> Test1));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sizeof(Test2) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> Test2));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(8)</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">S1</span><br>&#123;                <span class="hljs-comment">//对齐参数     偏移地址     大小</span><br>    <span class="hljs-type">short</span> a;     <span class="hljs-comment">//2            8           2</span><br>    <span class="hljs-type">long</span> b;      <span class="hljs-comment">//4            4           4</span><br>&#125;;  <br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">S2</span><br>&#123;                <span class="hljs-comment">//对齐参数     偏移地址     大小</span><br>    <span class="hljs-type">char</span> c;      <span class="hljs-comment">//1            0           1</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">S1</span> d; <span class="hljs-comment">//4            4           8</span><br>    <span class="hljs-type">double</span> e;    <span class="hljs-comment">//9            16          9</span><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack()</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> S1));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> S2));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gcc</span>编译器不支持<span class="hljs-number">8</span>字节对齐<br></code></pre></td></tr></table></figure>

<p>小结</p>
<p>#pragma用于指示编译器完成- -些特定的动作</p>
<p>#pragma所定义的很多指示字是编译器特有的</p>
<ul>
<li>#pragma message用于自定义编译消息</li>
<li>#pragma once用于保证头文件只被编译-次</li>
<li>#pragma pack用于指定内存对齐方式</li>
</ul>
<hr>
<p><strong>#和##操作符</strong></p>
<p>一、#运算符</p>
<p>#运算符用于在预处理期将宏参数转换为字符串</p>
<p>#的转换作用是在预处理期完成的,因此只在宏定义中有效</p>
<p>而编译器并不知道#的转换作用</p>
<p>用法</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">#define <span class="hljs-built_in">STRING</span>(x) #X<br>printf(<span class="hljs-string">&quot; %s\n&quot;</span>, <span class="hljs-built_in">STRING</span>(Hello World!)); .<br></code></pre></td></tr></table></figure>

<p>运算符的基本用法</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-comment">#define STRING(x) #x</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, STRING(Hello world!));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, STRING(<span class="hljs-number">100</span>));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, STRING(<span class="hljs-keyword">while</span>));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, STRING(<span class="hljs-keyword">return</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>/* test.i */<br><span class="hljs-comment"># 1 &quot;test.c&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;command-line&gt;&quot;</span><br><span class="hljs-comment"># 1 &quot;test.c&quot;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-string">&quot;Hello world!&quot;</span>);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-string">&quot;100&quot;</span>);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-string">&quot;while&quot;</span>);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-string">&quot;return&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运算符的妙用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-comment">/* 通过#运算符将f这个函数名转换为字符串打印出来 */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> CALL(f, p) (printf(<span class="hljs-string">&quot;Call function %s\n&quot;</span>, #f), f(p))</span><br>   <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">square</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> n * n;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> x;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> result = <span class="hljs-number">0</span>;<br>    <br>    result = <span class="hljs-built_in">CALL</span>(square, <span class="hljs-number">4</span>);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;result = %d\n&quot;</span>, result);<br>    <br>    result = <span class="hljs-built_in">CALL</span>(func, <span class="hljs-number">10</span>);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;result = %d\n&quot;</span>, result);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* test.i */</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;built-in&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;&lt;command-line&gt;&quot;</span><br># <span class="hljs-number">1</span> <span class="hljs-string">&quot;test.c&quot;</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">square</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> n * n;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> x;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> result = <span class="hljs-number">0</span>;<br><br>    result = (<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Call function %s\n&quot;</span>, <span class="hljs-string">&quot;square&quot;</span>), <span class="hljs-built_in">square</span>(<span class="hljs-number">4</span>));<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;result = %d\n&quot;</span>, result);<br><br>    result = (<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Call function %s\n&quot;</span>, <span class="hljs-string">&quot;func&quot;</span>), <span class="hljs-built_in">func</span>(<span class="hljs-number">10</span>));<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;result = %d\n&quot;</span>, result);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>二、##运算符</p>
<p>##运算符用于在预处理期粘连两个标识符</p>
<p>##的连接作用是在预处理期完成的,因此只在宏定义中有效</p>
<p>但编译器并不知道##的连接作用</p>
<p>用法</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">#define <span class="hljs-constructor">CONNECT(<span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span> a##b<br><span class="hljs-built_in">int</span> <span class="hljs-constructor">CONNECT(<span class="hljs-params">a</span>, 1)</span>;<br><span class="hljs-comment">// int al;</span><br>.a1= <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<p>运算符的基本用法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NAME(n) name##n</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">NAME</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span>;    <span class="hljs-comment">//name1</span><br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">NAME</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>;    <span class="hljs-comment">//name2</span><br>    <br>    <span class="hljs-built_in">NAME</span>(<span class="hljs-number">1</span>) = <span class="hljs-number">1</span>;    <span class="hljs-comment">//name1 = 1;</span><br>    <span class="hljs-built_in">NAME</span>(<span class="hljs-number">2</span>) = <span class="hljs-number">2</span>;    <span class="hljs-comment">//name2 = 2;</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">NAME</span>(<span class="hljs-number">1</span>));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">NAME</span>(<span class="hljs-number">2</span>));<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运算符的工程运用</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">#include <span class="hljs-operator">&lt;</span>stdio.h<span class="hljs-operator">&gt;</span><br><br><span class="hljs-operator">/*</span> 达到两个效果，首先使用一个typedef定义一个结构体标签，然后再定义一个结构体 <span class="hljs-operator">*/</span><br>#define STRUCT(<span class="hljs-keyword">type</span>) typedef <span class="hljs-keyword">struct</span> _tag_##<span class="hljs-keyword">type</span> <span class="hljs-keyword">type</span>;\<br>                     <span class="hljs-keyword">struct</span> _tag_##<span class="hljs-keyword">type</span><br><br>STRUCT(Student)<br>&#123;<br>    char<span class="hljs-operator">*</span> name;<br>    int <span class="hljs-built_in">id</span>;<br>&#125;;<br><br><span class="hljs-operator">/*</span> test.i中上面代码<br> <span class="hljs-operator">*</span> typedef <span class="hljs-keyword">struct</span> _tag_Student Student; <br> <span class="hljs-operator">*</span> <span class="hljs-keyword">struct</span> _tag_Student<br> <span class="hljs-operator">*/</span><br><br>int main()<br>&#123;<br>    <br>    Student s1;<br>    Student s2;<br>    <br>    s1.name <span class="hljs-operator">=</span> <span class="hljs-string">&quot;s1&quot;</span>;<br>    s1.<span class="hljs-built_in">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <br>    s2.name <span class="hljs-operator">=</span> <span class="hljs-string">&quot;s2&quot;</span>;<br>    s2.<span class="hljs-built_in">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;s1.name = %s\n&quot;</span>, s1.name);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;s1.id = %d\n&quot;</span>, s1.<span class="hljs-built_in">id</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;s2.name = %s\n&quot;</span>, s2.name);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;s2.id = %d\n&quot;</span>, s2.<span class="hljs-built_in">id</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>定义结构体后使用结构体需要重复写上struct student，所以应用typedef来节省时间，但结构体数目一多，又要定义很多typedef，这时就可以使用##连接符和#define。</p>
<p>小结</p>
<p>#运算符用于在预处理期将宏参数转换为字符串</p>
<p>##运算符用于在预处理期粘连两个标识符</p>
<p>编译器不知道#和##运算符的存在</p>
<p>#和##运算符只在宏定义中有效.</p>
<hr>
<p><strong>指针的本质分析</strong></p>
<p>程序中的变量只是一段存储空间的别名,那么是不是必须通过这个别名才能使用这段存储空间?</p>
<p>下面的程序输出什么?为什么?</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">int</span> i = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">int</span> *p = &amp;i;<br><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%d, %p\n&quot;</span>, i, p);<br>*p = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%d, %p\n&quot;</span>, i, p);<br></code></pre></td></tr></table></figure>

<p>一、*号的意义</p>
<p>在指针声明时, *号表示所声明的变量为指针</p>
<p>在指针使用时, *号表示取指针所指向的内存空间中的值</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">int</span> j = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//指针声明</span><br><span class="hljs-built_in">int</span>* p = &amp;i;<br><span class="hljs-comment">//取值</span><br>j = *p;<br></code></pre></td></tr></table></figure>

<p><img src="/image/d2a94a10dd2172a2d0bb16f122e262df.png" srcset="/img/loading.gif" lazyload alt="d2a94a10dd2172a2d0bb16f122e262df.png"></p>
<p>*号类似一把钥匙,通过这把钥匙可以打开内存,读取内存中的值。变量p保存着变量i的内存地址</p>
<p>例：指针使用示例</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span>* pI;<br>    char* pC;<br>    float* pF;<br>    <br>    pI = &amp;i;<br>    <br>    *pI = <span class="hljs-number">10</span>;<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%p, %p, %d\n&quot;</span>, pI, &amp;i, i);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%d, %d, %p\n&quot;</span>, sizeof(<span class="hljs-keyword">int</span>*), sizeof(pI), &amp;pI);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%d, %d, %p\n&quot;</span>, sizeof(char*), sizeof(pC), &amp;pC);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;%d, %d, %p\n&quot;</span>, sizeof(float*), sizeof(pF), &amp;pF);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>二、传值调用与传址调用</p>
<p>指针是变量,因此可以声明指针参数</p>
<p>当一个函数体内部需要改变实参的值, 则需要使用指针参数</p>
<p>函数调用时实参值将复制到形参</p>
<p>指针适用于复杂数据类型作为参数的函数中</p>
<p>例：利用指针交换变量</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>* a, <span class="hljs-type">int</span>* b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> c = *a;<br>    <br>    *a = *b;<br>    <br>    *b = c;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> aa = <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> bb = <span class="hljs-number">2</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;aa = %d, bb = %d\n&quot;</span>, aa, bb);<br>    <br>    <span class="hljs-built_in">swap</span>(&amp;aa, &amp;bb);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;aa = %d, bb = %d\n&quot;</span>, aa, bb);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>常量和指针</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span>* p;    <span class="hljs-comment">// p可变, p指向的内容不可变</span><br><span class="hljs-built_in">int</span> <span class="hljs-keyword">const</span>* p;    <span class="hljs-comment">// p可变, p指向的内容不可变</span><br><span class="hljs-built_in">int</span>* <span class="hljs-keyword">const</span> p;    <span class="hljs-comment">// p不可变, p指向的内容可变</span><br><span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span>* <span class="hljs-keyword">const</span> p;     <span class="hljs-comment">// p和p指向的内容都不可变</span><br></code></pre></td></tr></table></figure>

<p>口诀:左数右指</p>
<p>当const出现在*号左边时指针指向的数据为常量</p>
<p>当const出现在*后右边时指针本身为常量</p>
<p>例：常量与指针</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span>* p1 = &amp;i;<br>    <span class="hljs-type">int</span> <span class="hljs-type">const</span>* p2 = &amp;i;<br>    <span class="hljs-type">int</span>* <span class="hljs-type">const</span> p3 = &amp;i;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span>* <span class="hljs-type">const</span> p4 = &amp;i;<br>    <br>    *p1 = <span class="hljs-number">1</span>;    <span class="hljs-comment">// compile error</span><br>    p1 = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// ok</span><br>    <br>    *p2 = <span class="hljs-number">2</span>;    <span class="hljs-comment">// compile error</span><br>    p2 = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// ok</span><br>    <br>    *p3 = <span class="hljs-number">3</span>;    <span class="hljs-comment">// ok</span><br>    p3 = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// compile error</span><br>    <br>    *p4 = <span class="hljs-number">4</span>;    <span class="hljs-comment">// compile error</span><br>    p4 = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// compile error</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>指针是C语言中一 种特别的变量</p>
<p>指针所保存的值是内存的地址</p>
<p>可以通过指针修改内存中的任意地址内容</p>
<p><img src="/image/2fd02023538e4a5de653dbdcaafb452a.png" srcset="/img/loading.gif" lazyload alt="2fd02023538e4a5de653dbdcaafb452a.png"></p>
<hr>
<p>数组的本质分析</p>
<p>一、数组的概念</p>
<p>数组是相同类型的变量的有序集合</p>
<p><img src="/image/ef9f2cd13968402ae42b7c1d7f9c6516.png" srcset="/img/loading.gif" lazyload alt="ef9f2cd13968402ae42b7c1d7f9c6516.png"></p>
<p>二、数组的大小</p>
<p>数组在一片连续的内存空间中存储元素</p>
<p>数组元素的个数可以显示或隐式指定</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">inta</span>[<span class="hljs-number">5</span>]=&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br><span class="hljs-attribute">int</span> b[]= &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br></code></pre></td></tr></table></figure>

<p>问题:</p>
<ol>
<li><p>a[2], a[3], a[4]的值是多少?</p>
</li>
<li><p>b包含了多少个元素?</p>
</li>
</ol>
<p>代码实验：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">int</span> a[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-keyword">int</span> b[] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a[2] = %d\n&quot;</span>, a[<span class="hljs-number">2</span>]);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a[3] = %d\n&quot;</span>, a[<span class="hljs-number">3</span>]);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a[4] = %d\n&quot;</span>, a[<span class="hljs-number">4</span>]);<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(a) = %d\n&quot;</span>, sizeof(a));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(b) = %d\n&quot;</span>, sizeof(b));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;count for a: %d\n&quot;</span>, sizeof(a)/sizeof(<span class="hljs-keyword">int</span>));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;count for b: %d\n&quot;</span>, sizeof(b)/sizeof(<span class="hljs-keyword">int</span>));<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编译器会将后续没有指定数值的数初始化为0</p>
<p>三、数组地址与数组名</p>
<p>数组名代表数组首元素的地址，数组的地址需要用取地址符&amp;才能得到</p>
<p>数组首元素的地址值与数组的地址值相同，但数组首元素的地址与数组的地址是两个不同的概念</p>
<p>我们常说的地址包含了起始地址和所占内存的长度。（C语言不同的地方）</p>
<p>例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> a[<span class="hljs-number">5</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a = %p\n&quot;</span>, a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&amp;a = %p\n&quot;</span>, &amp;a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&amp;a[0] = %p\n&quot;</span>, &amp;a[<span class="hljs-number">0</span>]);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>四、数组名的盲点</p>
<p>数组名可以看做一个常量指针(const int*)</p>
<p>数组名”指向”的是内存中数组首元素的起始位置</p>
<p>数组名不包含数组的长度信息</p>
<p>在表达式中数组名只能作为右值使用</p>
<p>只有在下列场合中数组名不能看做常量指针</p>
<ul>
<li>数组名作为sizeof操作符的参数</li>
<li>数组名作为&amp;运算符的参数</li>
</ul>
<p>例：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">int</span> a[<span class="hljs-number">5</span>] = <span class="hljs-string">&#123;0&#125;</span>;<br>    <span class="hljs-keyword">int</span> b[<span class="hljs-number">2</span>];<br>    <span class="hljs-keyword">int</span>* p = NULL;<br>    <br>    p = a;<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a = %p\n&quot;</span>, a);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;p = %p\n&quot;</span>, p);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;&amp;p = %p\n&quot;</span>, &amp;p);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(a) = %d\n&quot;</span>, sizeof(a));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(p) = %d\n&quot;</span>, sizeof(p));<br>   <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>    p = b;<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;b = %p\n&quot;</span>, b);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;p = %p\n&quot;</span>, p);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;&amp;p = %p\n&quot;</span>, &amp;p);<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(b) = %d\n&quot;</span>, sizeof(b));<br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;sizeof(p) = %d\n&quot;</span>, sizeof(p));<br>    <br>    b = a;    <span class="hljs-regexp">//</span>error，数组名看作常量指针<br>  <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>数组是一片连续的内存空间</p>
<p>数组的地址和数组首元素的地址意义不同</p>
<p>数组名在大多数情况下被当成指针常量处理</p>
<p>数组名其实并不是指针，不能将其等同于指针</p>
<hr>
<p>指针和数组分析（上）</p>
<p>一、数组的本质</p>
<p>数组是一段连续的内存空间</p>
<p>数组的空间大小为sizeof(array_type) * array_size</p>
<p>数组名可看作指向数组第一个元素的常量指针</p>
<p>问题：</p>
<p>1.a + 1的意义是什么？结果是什么？</p>
<p>2.指针运算的意义是什么？结果又是什么？</p>
<p>例：a+1的结果是什么?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> a[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span>* p = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a = 0x%X\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(a));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a + 1 = 0x%X\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(a + <span class="hljs-number">1</span>));<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;p = 0x%X\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(p));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;p + 1 = 0x%X\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(p + <span class="hljs-number">1</span>));    <span class="hljs-comment">//0x0 + 1*sizeof(int)</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>二、指针的运算</p>
<p>2.1 指针是一种特殊的变量，其保存的也是一个值，与整数的运算规则为</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">p + n; &lt;-&gt; (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)p + <span class="hljs-function">n*<span class="hljs-title">sizeof</span><span class="hljs-params">(*p)</span></span>;<br></code></pre></td></tr></table></figure>

<p>结论:</p>
<p>当指针p指向一个同类型的数组的元素时: p+ 1将指向当前元素的下一个元素; p - 1将指向当前元素的上一个元素。</p>
<p>2.2 指针之间只支持减法运算,且参与减法运算的指针类型必须相同</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">p1 - p2;&lt;-&gt;((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)p1 - (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)p2)) / <span class="hljs-keyword">sizeof</span>(type);<br></code></pre></td></tr></table></figure>

<p>注意:</p>
<p>只有当两个指针指向同一个数组中的元素时,指针相减才有意义,其意义为指针所指元素的下标差。若是指向两个数组的同类型指针相减则语法正确，但结果未定义。</p>
<p>三、指针的比较</p>
<p>指针也可以进行关系运算( &lt;，&lt;&#x3D;， &gt;，&gt;&#x3D;)</p>
<p>指针关系运算的前提是同时指向同一个数组中的元素</p>
<p>任意两个指针之间的比较运算( &#x3D;&#x3D;,!&#x3D; )无限制</p>
<p>参与比较运算的指针类型必须相同</p>
<p>例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> s1[] = &#123;<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>&#125;;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> s2[] = &#123;<span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;;<br>    <span class="hljs-type">char</span>* p0 = s1;<br>    <span class="hljs-type">char</span>* p1 = &amp;s1[<span class="hljs-number">3</span>];<br>    <span class="hljs-type">char</span>* p2 = s2;<br>    <span class="hljs-type">int</span>* p = &amp;i;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 - p1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 + p2);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 - p2);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 - p);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 * p2);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, p0 / p2);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>例：数组的边界位置</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DIM(a) (sizeof(a) / sizeof(*a))</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> s[] = &#123;<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>&#125;;<br>    <span class="hljs-type">char</span>* pBegin = s;<br>    <span class="hljs-type">char</span>* pEnd = s + <span class="hljs-built_in">DIM</span>(s); <span class="hljs-comment">// Key point</span><br>    <span class="hljs-type">char</span>* p = <span class="hljs-literal">NULL</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pBegin = %p\n&quot;</span>, pBegin);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pEnd = %p\n&quot;</span>, pEnd);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Size: %d\n&quot;</span>, pEnd - pBegin);<br>    <br>    <span class="hljs-keyword">for</span>(p=pBegin; p&lt;pEnd; p++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, *p);<br>    &#125;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>   <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>数组的边界位置：pEnd指向了s数组最后一个元素后面的位置，这个位置是属于c语言的“擦边球”边界位置，在这个边界位置上我们认为这个指针是合法的，但这个位置再后面的元素都是没有意义的了</p>
<p>小结：</p>
<p>数组声明时编译器自动分配-片连续的内存空间</p>
<p>指针声明时只分配了用于容纳地址值的4字节空间</p>
<p>指针和整数可以进行运算,其结果为指针</p>
<p>指针之间只支持减法运算,其结果为数组元素下标差</p>
<p>指针之间支持比较运算,其类型必须相同</p>
<hr>
<p><strong>指针和数组分析（下）</strong></p>
<p>问题：数组名可以当作常量指针使用，那么指针是否也可以当作数组名来使用呢?</p>
<p>以下标的形式访问数组中的元素</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">int main()<br>&#123;<br>    int a[<span class="hljs-number">5</span>] <span class="hljs-operator">=</span> &#123;<span class="hljs-number">0</span>&#125;<span class="hljs-comment">;</span><br><br>    a[<span class="hljs-number">1</span>] <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-comment">;</span><br>    a[<span class="hljs-number">2</span>] <span class="hljs-operator">=</span> <span class="hljs-number">5</span><span class="hljs-comment">;</span><br><br>    return <span class="hljs-number">0</span><span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>以指针的形式访问数组中的元素</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>()</span><br>&#123;<br>    <span class="hljs-built_in">int</span> a[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br><br>    *(a + <span class="hljs-number">1</span>) = <span class="hljs-number">3</span>;<br>    *(a + <span class="hljs-number">2</span>) = <span class="hljs-number">5</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>一、下标形式VS指针形式</p>
<p>指针以固定增量在数组中移动时,效率高于下标形式</p>
<p>指针增量为1且硬件具有硬件增量模型时,效率更高</p>
<p>下标形式与指针形式的转换</p>
<p>a[n]&lt;--&gt;*(a+n)&lt;--&gt;*(n+a)&lt;--&gt;n[a]</p>
<p>注意:</p>
<p>现代编译器的生成代码优化率已大大提高,在固定增量时,下标形式的效率已经和指针形式相当;但从可读性和代码维护的角度来看，下标形式更优。</p>
<p>例1：数组的访问方式</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><br><span class="hljs-keyword">int</span> main()<br>&#123;<br>    <span class="hljs-keyword">int</span> a[<span class="hljs-number">5</span>] = <span class="hljs-string">&#123;0&#125;</span>;<br>    <span class="hljs-keyword">int</span>* p = a;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        p[i] = i + <span class="hljs-number">1</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;a[%d] = %d\n&quot;</span>, i, *(a + i));<br>    &#125;<br>    <br>    <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        i[a] = i + <span class="hljs-number">10</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">printf</span>(<span class="hljs-string">&quot;p[%d] = %d\n&quot;</span>, i, p[i]);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>指针可以当作数组名使用，前提指针指向了一个合法的数组</p>
<p>例2：数组和指针不同</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">extern</span> <span class="hljs-type">int</span>* a;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;&amp;a = %p\n&quot;</span>, &amp;a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a = %p\n&quot;</span>, a);    <span class="hljs-comment">//a被定义为指针，到地址a处取4个字节</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;*a = %d\n&quot;</span>, *a);   <span class="hljs-comment">//段错误，访问0x1，</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/* ext.c */</span><br><span class="hljs-type">int</span> a[] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br></code></pre></td></tr></table></figure>

<p>指针不是数组，数组也不是指针，只是在某些情况下，他们可以看作彼此</p>
<p>int a[5]，编译器会在内存中分配20个字节：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>//小端系统<br></code></pre></td></tr></table></figure>

<p>数组地址为0x804a014，取四个字节即取1000（低地址-&gt;高地址），实际上数是1</p>
<p>二、a和&amp;a的区别</p>
<p>a为数组首元素的地址</p>
<p>&amp;a为整个数组的地址</p>
<p>a和&amp;a的区别在于指针运算</p>
<p>a + 1    ---&gt; (unsigned int)a + sizeof(*a)    &#x2F;&#x2F;增加步长为一个元素的大小</p>
<p>&amp;a + 1---&gt; (unsigned int)(&amp;a) + sizeof(*&amp;a)---&gt;(unsigned int)(&amp;a) + sizeof(a)    &#x2F;&#x2F;增加步长为一个数组的大小</p>
<p>例：指针运算经典问题</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs smali"><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>main()<br>&#123;<br>   <span class="hljs-built_in"> int </span>a[5] = &#123;1, 2, 3, 4, 5&#125;;<br>    int* p1 = (int*)(&amp;a + 1);    //p1[-1]==&gt;*(p1-1)移动一个数组的步长，指向5后面的位置<br>    int* p2 = (int*)((int)a + 1);//p2 = 0x804a014 + 1 = 0x804a015,去p2[0] = *p2的地方取4个字节，为0x02000000 = 33554432<br>    int* p3 = (int*)(a + 1);    //a[1]<br>    <br>/* p1[-1]==&gt;*(p1 - 1) <br> * p2[0]==&gt;*(p2 + 0)==&gt;*p2<br> */<br>    printf(<span class="hljs-string">&quot;%d, %d, %d\n&quot;</span>, p1[-1], p2[0], p3[1]);<br>    <br>   <span class="hljs-built_in"> return </span>0;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>三、数组参数</p>
<p>数组作为函数参数时,编译器将其编译成对应的指针</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">int</span> a[])</span></span>; &lt;--&gt; <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">int</span>* a)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">int</span> a[<span class="hljs-number">5</span>])</span></span>; &lt;--&gt; <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">int</span>* a)</span></span>;<br></code></pre></td></tr></table></figure>

<p>结论:</p>
<p>一般情况下,当定义的函数中有数组参数时,需要定义另一个参数来标示数组的大小。</p>
<p>例：虚幻的数组参数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">(<span class="hljs-type">char</span> a[<span class="hljs-number">5</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;In func1: sizeof(a) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(a));<br>    <br>    *a = <span class="hljs-string">&#x27;a&#x27;</span>;    <span class="hljs-comment">//可以修改</span><br>    <br>    a = <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func2</span><span class="hljs-params">(<span class="hljs-type">char</span> b[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;In func2: sizeof(b) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(b));<br>    <br>    *b = <span class="hljs-string">&#x27;b&#x27;</span>;    <span class="hljs-comment">//可以修改</span><br>    <br>    b = <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> array[<span class="hljs-number">10</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <br>    <span class="hljs-built_in">func1</span>(array);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;array[0] = %c\n&quot;</span>, array[<span class="hljs-number">0</span>]);    <span class="hljs-comment">//a</span><br>    <br>    <span class="hljs-built_in">func2</span>(array);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;array[0] = %c\n&quot;</span>, array[<span class="hljs-number">0</span>]);    <span class="hljs-comment">//b</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>数组参数在编译后变成了指针</p>
<p>小结：</p>
<p>数组名和指针仅使用方式相同</p>
<ul>
<li>数组名的本质不是指针</li>
<li>指针的本质不是数组</li>
</ul>
<p>数组名并不是数组的地址,而是数组首元素的地址</p>
<p>函数的数组参数退化为指针</p>
<hr>
<p><strong>字符串</strong></p>
<p>一、概念</p>
<p>字符串是有序字符的集合</p>
<p>字符串是程序中的基本元素之一</p>
<p>C语言中没有字符串的概念</p>
<ul>
<li>C语言中通过特殊的字符数组模拟字符串</li>
<li>C语言中的字符串是以’\0’ 结尾的字符数组</li>
</ul>
<p>二、字符数组与字符串</p>
<p>在C语言中,双引号引用的单个或多个字符是一种特殊的字面量</p>
<ul>
<li>存储于程序的全局只读存储区</li>
<li>本质为字符数组,编译器自动在结尾加上’\0’字符</li>
</ul>
<p>例1 ：下面那些是字符串的定义?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> ca[] = &#123;<span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>&#125;;        <span class="hljs-comment">//err</span><br>    <span class="hljs-type">char</span> sa[] = &#123;<span class="hljs-string">&#x27;W&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;\0&#x27;</span>&#125;;  <br>    <span class="hljs-type">char</span> ss[] = <span class="hljs-string">&quot;Hello world!&quot;</span>;    <span class="hljs-comment">//可以使用字符串字面量初始化一个数组</span><br>    <span class="hljs-type">char</span>* str = <span class="hljs-string">&quot;Hello world!&quot;</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, ca);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, sa);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, ss);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, str);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>C语言中所有与字符串相关的操作都依赖于\0，若字符串没有\0则退化成字符数组，字符数组不可以作为参数被字符串处理函数处理。</p>
<p>三、字符串字面量的本质</p>
<ul>
<li>字符串字面量的本质是一个数组</li>
<li>字符串字面量可以看作常量指针</li>
<li>字符串字面量中的字符不可改变</li>
<li>字符串字面量至少包含一个字符</li>
</ul>
<p>“Hello World”是一个无名的字符数组</p>
<p>例2：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> b = <span class="hljs-string">&quot;abc&quot;</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">char</span> c = *(<span class="hljs-string">&quot;123&quot;</span> + <span class="hljs-number">1</span>);<br>    <span class="hljs-type">char</span> t = *<span class="hljs-string">&quot;&quot;</span>;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c\n&quot;</span>, b);    <span class="hljs-comment">//a</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c\n&quot;</span>, c);    <span class="hljs-comment">//2</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, t);    <span class="hljs-comment">//0，&#x27;\0&#x27;对应的ASCII值为0</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, <span class="hljs-string">&quot;Hello&quot;</span>);    <span class="hljs-comment">//Hello</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, <span class="hljs-string">&quot;World&quot;</span>);    <span class="hljs-comment">//地址值</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>四、字符串的长度</p>
<p>字符串的长度就是字符串所包含字符的个数</p>
<p>字符串长度指的是第-一个’\0’ 字符前出现的字符个数</p>
<p>通过’\0’ 结束符来确定字符串的长度</p>
<p>函数strlen用于返回字符串的长度</p>
<p>例3:strlen的使用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> s[] = <span class="hljs-string">&quot;Hello\0world&quot;</span>;<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-built_in">sizeof</span>(s)/<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>); i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c\n&quot;</span>, s[i]);<br>    &#125;<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, s);    <span class="hljs-comment">//Hello</span><br><br>    <span class="hljs-built_in">printf</span>( <span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">strlen</span>(s) );        <span class="hljs-comment">//5</span><br>    <span class="hljs-built_in">printf</span>( <span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;123&quot;</span>) );    <span class="hljs-comment">//3</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>小结：</p>
<p>C语言中通过字符数组模拟字符串</p>
<p>C语言中的字符串使用’\0’ 作为结束符</p>
<p>字符串字面量的本质为字符数组</p>
<p>字符串相关函数都依赖于结束符’\0’</p>
<hr>
<p>字符串经典问题</p>
<p>例1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">10</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">char</span> src[] = <span class="hljs-string">&quot;hello %s&quot;</span>;<br>    <br>    <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-built_in">sizeof</span>(buf), src);    <span class="hljs-comment">//将src打印到buf里</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;buf = %s\n&quot;</span>, buf);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>输出结果：<br>buf = hello ??<br></code></pre></td></tr></table></figure>

<p>snprintf函数本身是可变参数函数,原型如下:</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">snprintf</span><span class="hljs-params">( <span class="hljs-type">char</span>* buffer, <span class="hljs-type">int</span> buf_ size, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fomart, ... )</span></span><br></code></pre></td></tr></table></figure>

<p>当函数只有3个参数时,如果第三个参数没有包含格式化信息,函数调用没有问题;相反,如果第三个参数包含了格式化信息,但缺少后续对应参数,则程序行为不确定。</p>
<p>例2：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> STR <span class="hljs-string">&quot;Hello, \0D.T.Software\0&quot;</span></span><br>    <br>    <span class="hljs-type">char</span>* src = STR;<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">255</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <br>    <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-built_in">sizeof</span>(buf), src);    <span class="hljs-comment">//无格式化字符，调用合法，buf为Hello,</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;strlen(STR) = %d\n&quot;</span>, <span class="hljs-built_in">strlen</span>(STR));    <span class="hljs-comment">//7</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sizeof(STR) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(STR));    <span class="hljs-comment">//22</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;strlen(src) = %d\n&quot;</span>, <span class="hljs-built_in">strlen</span>(src));    <span class="hljs-comment">//7</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sizeof(src) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(src));    <span class="hljs-comment">//4</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;strlen(buf) = %d\n&quot;</span>, <span class="hljs-built_in">strlen</span>(buf));    <span class="hljs-comment">//7</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sizeof(buf) = %d\n&quot;</span>, <span class="hljs-built_in">sizeof</span>(buf));    <span class="hljs-comment">//255</span><br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;src = %s\n&quot;</span>, src);    <span class="hljs-comment">//Hello,</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;buf = %s\n&quot;</span>, buf);    <span class="hljs-comment">//Hello.</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字符串相关的函数均以第一个出现的\0’ 作为结束符，如snprintf，strlen，sizeof</p>
<p>编译器总是会在字符串字面量的末尾添加’\0’</p>
<p>字符串字面量的本质为数组</p>
<p>例3：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> S1 <span class="hljs-string">&quot;D.T.Software&quot;</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> S2 <span class="hljs-string">&quot;D.T.Software&quot;</span></span><br>    <br>    <span class="hljs-keyword">if</span>( S1 == S2 )                <span class="hljs-comment">//gcc：Equal；bcc：Non Equal</span><br>                                  <span class="hljs-comment">//gcc进行了优化，将S1与S2指向了同一个字符串字面量，故相等</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equal\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Non Equal\n&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-built_in">strcmp</span>(S1, S2) == <span class="hljs-number">0</span> )    <span class="hljs-comment">//gcc：Equal;bcc：Equal</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Equal\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Non Equal\n&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>字符串之间的相等比较需要用strcmp 完成</p>
<p>不可直接用&#x3D;&#x3D;进行字符串直接的比较</p>
<p>完全相同的字符串字面量的&#x3D;&#x3D;比较结果为false</p>
<p>一些现代编译器能够将相同的字符串字面量映射到同一个无名字符数组,因此&#x3D;&#x3D;比较结果为true。</p>
<p>例4：</p>
<p>字符串循环右移函数</p>
<p>void right_ shift_ _r(const char* src, char* result, unsigned int n);</p>
<p>函数功能:将输入字符串src循环右移n位，result 为输出结果。</p>
<p>要求:以效率最高的方式实现。</p>
<p>示例:</p>
<p>“abcde”    -- 2 --&gt;    “deabc”</p>
<p>“abcde”    -- 8 --&gt;    “cdeab”</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">right_shift_r</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* src, <span class="hljs-type">char</span>* result, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> LEN = <span class="hljs-built_in">strlen</span>(src);<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>        <br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;LEN; i++)<br>    &#123;<br>        result[(n + i) % LEN] = src[i];<br>    &#125;<br>    <br>    result[LEN] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> result[<span class="hljs-number">255</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <br>    <span class="hljs-built_in">right_shift_r</span>(<span class="hljs-string">&quot;abcde&quot;</span>, result, <span class="hljs-number">2</span>);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, result);    <span class="hljs-comment">//deabc</span><br>    <br>    <span class="hljs-built_in">right_shift_r</span>(<span class="hljs-string">&quot;abcde&quot;</span>, result, <span class="hljs-number">5</span>);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, result);    <span class="hljs-comment">//abcde</span><br>    <br>    <span class="hljs-built_in">right_shift_r</span>(<span class="hljs-string">&quot;abcde&quot;</span>, result, <span class="hljs-number">8</span>);<br>    <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, result);    <span class="hljs-comment">//cdeab</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p>指针数组与数组指针</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/C%E8%AF%AD%E8%A8%80/" class="category-chain-item">C语言</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/C/">#C</a>
      
        <a href="/tags/%E6%9C%AA%E9%87%8D%E6%9E%84/">#未重构</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>狄泰C语言进阶课程</div>
      <div>https://godxqi.github.io/2023/01/15/C语言/狄泰C语言进阶课程/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>GODXQI</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>January 15, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
